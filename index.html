<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; I am Travis</title>
<meta name="description" content="The World of Travis B. Hartwell">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://iam.travishartwell.net/images/abstract-1.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="The World of Travis B. Hartwell">
<meta name="twitter:creator" content="@travisbhartwell">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="The World of Travis B. Hartwell">
<meta property="og:url" content="http://iam.travishartwell.net/index.html">
<meta property="og:site_name" content="I am Travis">

<meta name="google-site-verification" content="WmaLXA_7GzOWYRF_aJcdtjukq4VdmHE9EJlzVDOFGTc">
<meta name="msvalidate.01" content="C445B4E265CC0E3E4ABAA52E3B998CD3">


<link rel="canonical" href="http://iam.travishartwell.net/">
<link href="http://iam.travishartwell.net/feed.xml" type="application/atom+xml" rel="alternate" title="I am Travis Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://iam.travishartwell.net/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://iam.travishartwell.net/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://iam.travishartwell.net/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://iam.travishartwell.net/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://iam.travishartwell.net/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://iam.travishartwell.net/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://iam.travishartwell.net/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://iam.travishartwell.net/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://iam.travishartwell.net/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://iam.travishartwell.net/images/avatar.jpg" alt="Travis B. Hartwell photo" class="author-photo">
					<h4>Travis B. Hartwell</h4>
					<p>LDS. Meditator. Kidney transplant recipient. On dialysis. Losing vision to Retinitis Pigmentosa. Software Toolsmith. Free/Open Source advocate. Writer. Friend.</p>
				</li>
				<li><a href="http://iam.travishartwell.net/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:nafai@travishartwell.net"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/travisbhartwell"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://facebook.com/travisbhartwell"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				<li>
					<a href="https://google.com/+TravisBHartwell"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="http://linkedin.com/in/travisbhartwell"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/travisbhartwell"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="http://gitlab.com/travisbhartwell"><i class="fa fa-fw fa-git"></i> GitLab</a>
				</li>
				<li>
					<a href="http://stackexchange.com/users/6460/travis-b-hartwell"><i class="fa fa-fw fa-stack-exchange"></i> Stackexchange</a>
				</li>
				<li>
					<a href="http://instagram.com/travisbhartwell"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://iam.travishartwell.net/posts/">All Posts</a></li>
				<li><a href="http://iam.travishartwell.net/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="http://iam.travishartwell.net/images/abstract-1.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>I am Travis</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-07-29T23:00:00-06:00"><a href="http://iam.travishartwell.net/2015/07/29/how-to-make-a-pr-for-spacemacs/">July 29, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://iam.travishartwell.net/about/" title="About Travis B. Hartwell">Travis B. Hartwell</a></span></span>
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://iam.travishartwell.net/2015/07/29/how-to-make-a-pr-for-spacemacs/" rel="bookmark" title="How to Make a Pull Request for Spacemacs" itemprop="url">How to Make a Pull Request for Spacemacs</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I’ve created a screencast demonstrating making a <a href="https://help.github.com/articles/using-pull-requests/">pull request</a> for open source projects, specifically, <a href="https://github.com/syl20bnr/spacemacs">Spacemacs</a>.  The principles explained here apply to any Git and Github based project.  In this screencast, I demonstrate fixing an <a href="https://github.com/syl20bnr/spacemacs/issues/2431">issue I reported</a> with how bookmarks were being handled in the Spacemacs home buffer:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/pWzJ6IGXwmk" frameborder="0" allowfullscreen=""> </iframe>

<h2 id="how-to-do-it">How to do it</h2>

<h3 id="fork-the-repository">Fork the Repository</h3>
<p>Create the <a href="https://help.github.com/articles/fork-a-repo/">fork</a> by visiting the project page on Github.  In the case of Spacemacs, it’s at <a href="https://github.com/syl20bnr/spacemacs/">https://github.com/syl20bnr/spacemacs/</a>.  On that page, click the <em>Fork</em> button on the upper right side of the page.  If you happen to belong to organizations on Github (which I do, as seen in the video), you will be prompted to select where to fork the repository.  Select your user.</p>

<p>This will create a new repository for your user that is a mirror of the current state of the <a href="https://help.github.com/articles/github-glossary/#upstream">upstream</a> repository.</p>

<p>Note the repository clone URL that is shown on the right-hand side of the page, part way down.  This is needed when you add your repository as a remote to your local checkout.</p>

<h3 id="update-your-local-repository">Update your local repository</h3>
<p>Next, you need to make sure your local checkout of the Spacemacs repository is up to date.  As specified in the <a href="https://github.com/syl20bnr/spacemacs/blob/develop/doc/CONTRIBUTE.org#pull-request-guidelines">Spacemacs Contributor Guidelines</a>, contributions are best done off of the <code>develop</code> branch.</p>

<ol>
  <li>
    <p>Go to magit-status for the Spacemacs repository by doing <code>SPC u SPC g s</code> (<em>Hit the spacebar, then u, then the spacebar again, then g, then s</em>).  Then enter the path of the Spacemacs repository, <code>~/.emacs.d</code>, and hit <code>RETURN</code>.</p>
  </li>
  <li>
    <p>Switch to the develop branch, if you are not already there. Hit <code>b b</code> and type <code>develop</code>.  One thing I did not cover in the video is the case if you haven’t already checked out the develop branch previously, instead of <code>b b</code> (or, <em>branch checkout</em>), you need to do <code>b B</code> (or, <em>create and checkout</em>).  It will prompt you for the branch to base it off of, select or type <code>origin/develop</code>, hit <code>RETURN</code> and then name the branch <code>develop</code>.  Note that any time in the <code>magit-status</code> buffer, if you want to know what commands are available, just hit <code>?</code>.</p>
  </li>
  <li>
    <p>After you have the develop branch checked out, update it against the remote upstream repository.  Hit <code>F</code> for Pulling.  Then type <code>-r</code> to rebase.  Even though we don’t yet have any local commits, it makes sense to rebase any unpushed commits on the remote branch so that they are up to date and can be merged without merge commits.  Hit <code>F</code> to pull and rebase.  After this is done, we want to restart Emacs to run any of the latest changes.  Hit <code>SPC q q</code> to quit Emacs.  Relaunch Emacs.</p>
  </li>
</ol>

<h3 id="adding-your-remote">Adding your remote</h3>

<p>We now need to add our newly-forked remote repository as a remote in our Spacemacs repository.  There are several strategies that can be taken here.  One option is to wipe your <code>~/.emacs.d</code> directory and clone your fork, making it <code>origin</code>.  You would then add the upstream, original repository as a new remote (perhaps named <code>upstream</code>) that you could pull from.  But since I am more often than not going to be running and updating code from the upstream repository, I will leave the upstream as <code>origin</code>, and add my fork as <code>mine</code>.</p>

<ol>
  <li>
    <p>Go to the <code>magit-status</code> buffer again: <code>SPC u SPC g s ~/.emacs.d RET</code>.</p>
  </li>
  <li>
    <p>Hit <code>M</code> (or, <em>Remoting</em>) and then <code>a</code> (or, <em>Add</em>).</p>
  </li>
  <li>
    <p>When prompted, give the remote a name.  I called it <code>mine</code>.</p>
  </li>
  <li>
    <p>When prompted for the remote URL, put the URL that you copied from the <em>Clone URL</em> on your project page.  For example, mine was <code>git@github.com:travisbhartwell/spacemacs</code>.</p>
  </li>
</ol>

<h3 id="creating-a-branch-for-your-changes">Creating a branch for your changes</h3>

<p>Before any changes are made, we need to make a branch to put them in.  You could just commit to the <code>develop</code> branch, push your changes to your fork, and then do a pull request off of that.  But since I often have multiple pull requests open at one time, I find it simpler to do a branch per pull request.  This also allows my branches to have meaningful names.</p>

<ol>
  <li>
    <p>From the <code>magit-status</code> buffer, hit <code>b B</code> (or, <em>create and checkout branch</em>).</p>
  </li>
  <li>
    <p>magit will then prompt you for the branch you are branching off of.  Choose <code>develop</code>.</p>
  </li>
  <li>
    <p>Next, it will prompt you for a branch name.  I like long descriptive names, so I chose <code>fix/spacemacs-home-buffer-bookmarks-jump</code>.</p>
  </li>
</ol>

<p>Check out the <a href="http://git-scm.com/book/en/v2/Git-Branching-Branches-in-a-Nutshell">Git book chapter on branching</a> for an in-depth discussion of branching.</p>

<h3 id="make-commit-and-push-changes">Make, commit, and push changes</h3>

<p>Now that we have a branch we can make our changes.  In the video, I used a previously created <a href="http://git-scm.com/book/en/v2/Git-Tools-Stashing-and-Cleaning">Git stash</a> to quickly apply changes to my repository.  I simply applied it by hitting <code>z p</code> (or, <em>Stash pop</em>).  Go ahead and make the changes you want.  After you have tested and are satisfied with them, you are ready to commit and push.</p>

<ol>
  <li>
    <p>Go to the <code>magit-status</code> buffer again: <code>SPC u SPC g s ~/.emacs.d RET</code>.</p>
  </li>
  <li>
    <p>Stage any unstaged changes you have made.  Quickly: hit <code>s</code> on each line under <em>Unstaged changes</em> corresponding to a file you’ve changed.</p>
  </li>
  <li>
    <p>Hit <code>c c</code> to commit all staged changes.</p>
  </li>
  <li>
    <p>Type a meaningful commit message.  (See <a href="http://chris.beams.io/posts/git-commit/">this post</a> for a great explanation of what a good commit message is.)  Helpfully, the diff of what you have changed is shown on the right-hand side for you to see what you did.  Make the first line be a short subject describing the commit.  Add a blank line and then in lines wrapped at 78, write a brief description of the changes and why.  If you are fixing an issue that has been filed, include something along the lines of ‘Fixes #2431’.  Hit <code>C-c C-c</code> (<em>that’s Control and c together, and then again</em>).</p>
  </li>
  <li>
    <p>Hit <code>P</code> (or, <em>Pushing</em>).  Then, <code>-u</code> to set the upstream so subsequent pushes, if needed, default to this remote.  Then <code>P</code> (or, <em>Push current</em>).  Start typing the name of your remote (in my case, <code>mine</code>), and it will finish the branch name for you – <code>mine/fix/spacemacs-home-buffer-bookmarks-jump</code>.  Hit <code>RETURN</code>.</p>
  </li>
</ol>

<h3 id="make-the-pull-request">Make the pull request</h3>

<p>You are now ready to submit your pull request.  Switch back to your browser to the page for your fork.</p>

<ol>
  <li>
    <p>Github will show your recently pushed branches near the top, in a yellow box.  Refresh your page if you don’t see this.  Click the green <em>“Compare &amp; pull request”</em> button.</p>
  </li>
  <li>
    <p>In the next screen, Github will prompt you for a branch to compare against.  By default it will show <em>base: master</em>.  We want to select <code>develop</code> here.  As shown in the video, it make take a minute for the page to update after you have selected the <code>develop</code> branch.</p>
  </li>
  <li>
    <p>If you’ve done everything right, it will be able to cleanly merge your commit and will indicate so.  It will then pull from your commit message the subject and description.  If you’ve written a good commit message, there should be no need to add anything here.  Click <em>Create pull request</em>.</p>
  </li>
</ol>

<p>Congratulations!  There you go, you have created your first pull request.  Hopefully the project developers will like your pull request and merge it.</p>

<p>Happy Hacking!</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-07-20T20:45:00-06:00"><a href="http://iam.travishartwell.net/2015/07/20/announce-nix-emacs/">July 20, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://iam.travishartwell.net/about/" title="About Travis B. Hartwell">Travis B. Hartwell</a></span></span>
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://iam.travishartwell.net/2015/07/20/announce-nix-emacs/" rel="bookmark" title="Announcing nix-emacs v0.0.1" itemprop="url">Announcing nix-emacs v0.0.1</a></h1>
    
  </header>
  <div class="entry-content">
    <p>My friend <a href="http://cestdiego.github.io">Diego Berrocal</a> and I would like to announce the release of <a href="https://github.com/travisbhartwell/nix-emacs/releases/tag/v0.0.1">nix-emacs v0.0.1</a>.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/4FZl_a7YQIA" frameborder="0" allowfullscreen=""> </iframe>

<p>nix-emacs adds support for searching and completing options in <a href="http://nixos.org">Nix OS</a> configuration files.  Nix OS is configured using the Nix expression language.  This includes configuration from your hostname to options for various services you may enable.  The <a href="https://nixos.org/nixos/manual/ch-options.html">online documentation</a> lists the abundant options available.  There is also a <a href="https://nixos.org/nixos/options.html">handy interface</a> for searching the options.</p>

<p>But, we found it less than ideal to have to constantly switch back and forth between the browser and our editor while editing our configurations.</p>

<p>Included is support for:</p>

<ul>
  <li>A <a href="https://emacs-helm.github.io/helm/">helm</a> source for searching the options and viewing documentation</li>
</ul>

<p><img src="https://github.com/travisbhartwell/nix-emacs/raw/v0.0.1/img/helm-nixos-options.gif" alt="helm-nixos-options" /></p>

<ul>
  <li>A <a href="http://company-mode.github.io/">company</a> backend for completion of option names in nix-mode files.</li>
</ul>

<p><img src="https://github.com/travisbhartwell/nix-emacs/raw/v0.0.1/img/company-nixos-options.gif" alt="company-nixos-options" /></p>

<p>Check out the <a href="https://github.com/travisbhartwell/nix-emacs/blob/v0.0.1/README.org">README</a> for instructions on how to use nix-emacs.</p>

<p>We’ve submitted pull requests to get this included in <a href="http://melpa.org/#/">MELPA</a> so you can easily install it.  Also, we’ve submitted a pull request to <a href="https://github.com/syl20bnr/spacemacs/">Spacemacs</a>, the Emacs configuration we both use, to add a Nix layer, with everything configured out of the box.</p>

<p>This is just an initial release.  Hopefully more refinements to come.  Feel free to follow along on <a href="https://github.com/travisbhartwell/nix-emacs/">Github</a>.  Submit any issues you may have or submit pull requests.</p>

<p>We also have a <a href="https://gitter.im/travisbhartwell/nix-emacs?utm_source=share-link&amp;utm_medium=link&amp;utm_campaign=share-link">Gitter</a> channel, if you want to chat with us.  We hope to make it a place to discuss all things Emacs, Spacemacs, and Nix, so please join us.</p>

<hr />

<p>Updated on 2015-07-21 to add Gitter link.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-07-17T09:45:00-06:00"><a href="http://iam.travishartwell.net/2015/07/17/looking-for-contract-work/">July 17, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://iam.travishartwell.net/about/" title="About Travis B. Hartwell">Travis B. Hartwell</a></span></span>
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://iam.travishartwell.net/2015/07/17/looking-for-contract-work/" rel="bookmark" title="Looking for remote, part-time contract work" itemprop="url">Looking for remote, part-time contract work</a></h1>
    
  </header>
  <div class="entry-content">
    <p>After an extended break in my career due to chronic illness, I am looking to return to part-time work.  Because of my location and inability to drive, this will have to be a remote position.</p>

<p>I am available starting tentatively the second week of September.  My goal is to work 15-20 hours a week.</p>

<p>I am experienced in both software development and system administration.  Professionally, I’ve primarily done work in Python and Java, and in packaging for and managing Debian and Ubuntu machines.  Lately, my interests have led me to use NixOS and to pursue learning Haskell and other functional programming languages.  Ideally, I’d love to work with the two of those.</p>

<p>I’ve been busy recently dipping my toes in various technologies and helping with open source projects, including Nix OS, Spacemacs, and the Lowbrow browser.  I’ve been doing remote pairing with friends.  I’ve been helping out on IRC and bug trackers for the projects that I use.</p>

<p>My primary skill is learning new technologies and learning the best ways to leverage tools.</p>

<p>Please reach out to me if you think I could help you out.  Check out my <a href="http://iam.travishartwell.net/resume/">resume</a> for further details on my experience and skills.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-07-03T19:00:00-06:00"><a href="http://iam.travishartwell.net/2015/07/03/introduction-to-spacemacs-installation-screencast/">July 03, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://iam.travishartwell.net/about/" title="About Travis B. Hartwell">Travis B. Hartwell</a></span></span>
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://iam.travishartwell.net/2015/07/03/introduction-to-spacemacs-installation-screencast/" rel="bookmark" title="Introduction to Spacemacs: Installation" itemprop="url">Introduction to Spacemacs: Installation</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I created a quick screencast the other day.  It was an introduction to <a href="https://github.com/syl20bnr/spacemacs/">Spacemacs</a>, a starter kit or configuration for Emacs, that is self-proclaimed as an “Emacs advanced Kit focused on Evil: The best editor is neither Emacs nor Vim, it’s Emacs <em>and</em> Vim!”.  In this screencast, I cover installation, showing installation in an Ubuntu 15.04 virtual machine.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/xFp9Jahs8Ng" frameborder="0" allowfullscreen=""> </iframe>

<p>All that is required is Gnu Emacs 24 and git.</p>

<p>Feel free to check out my <a href="https://gitlab.com/travisbhartwell/vcsh_emacs/tree/master">Spacemacs configuration</a>.  Reach out on <a href="http://www.twitter.com/travisbhartwell">Twitter</a> if you have any questions.</p>

<p>I hope to make some more of these soon, about Spacemacs and perhaps other topics.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-06-17T08:00:00-06:00"><a href="http://iam.travishartwell.net/2015/06/17/nix-shell-shebang/">June 17, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://iam.travishartwell.net/about/" title="About Travis B. Hartwell">Travis B. Hartwell</a></span></span>
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://iam.travishartwell.net/2015/06/17/nix-shell-shebang/" rel="bookmark" title="nix-shell and Shebang Lines" itemprop="url">nix-shell and Shebang Lines</a></h1>
    
  </header>
  <div class="entry-content">
    <p>A few days ago, version 1.9 of the Nix package manager
<a href="https://nixos.org/releases/nix/nix-1.9/manual/#ssec-relnotes-1.9">was released</a>.
From the release notes:</p>

<blockquote>
  <p>nix-shell can now be used as a #!-interpreter. This allows you to write scripts that dynamically fetch their own dependencies.</p>
</blockquote>

<p>They followed with an example that used GHC’s <code>runhaskell</code> to execute Haskell
code using libraries that had been specified in the shebang line.
Unfortunately, this specific example doesn’t work, as it isn’t sufficient
information for Haskell to find the Network.HTTP library.  But this notwithstanding,
it is still an interesting change that I have found useful.</p>

<h2 id="why">Why?</h2>

<p>First, why would you use this?  Several reasons.  As quoted above, your scripts
can auto-fetch their own dependencies.  This makes sharing and deploying scripts
to other Nix-based systems easy.  No having to remember exactly everything that
is needed.  The script will fetch and install whatever it needs.  If the system
already has the package installed, Nix will just use that.</p>

<p>Second, I use this (as is one of my big motivations for Nix in general) to
isolate things.  I have the minimum set of packages installed to keep my system
running and support the applications I run regularly.  Then particularly for
project specific scripts – things not useful outside the context of the
project, or may have dependencies separate from what the system in general might
use – I like using <code>nix-shell</code> scripts.  I don’t have to install all of the
libraries (gems, npm packages, etc) needed and clutter up my system or <code>$HOME</code>.</p>

<h2 id="using-nix-shell-in-a-shebang-line">Using nix-shell in a Shebang Line</h2>

<p>To use it, start your scripts with two lines similar to this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env nix-shell</span>
<span class="c">#! nix-shell -i python3 -p python3 python34Packages.pygobject3 libnotify gobjectIntrospection gdk_pixbuf</span></code></pre></div>

<p>This is a little different than some other shebang lines you might have seen
before.  First, why use <code>/usr/bin/env</code> instead of calling <code>nix-shell</code> directly?
As explained in the answers to this
<a href="http://unix.stackexchange.com/questions/29608/why-is-it-better-to-use-usr-bin-env-name-instead-of-path-to-name-as-my">Unix StackExchange question</a>,
this allows the script to be more portable.  On NixOS systems, you could
generally reference <code>/run/current-system/sw/bin/nix-shell</code> as the <code>nix-shell</code>
path.  In fact, in previous edits of this post I used that in some of my
examples.  But if you wanted to share this with a system that was using Nix on
top of another distribution or OS, that wouldn’t work.</p>

<p>Related, the second line is needed to get around a potential limitation
(depending on the system you are running on) in the way that interpreted scripts
are launched.  Quoting the <em>Interpreter scripts</em> paragraphs under the <em>NOTES</em>
section of the
<a href="http://man7.org/linux/man-pages/man2/execve.2.html">execve(2) man page</a>: </p>

<blockquote>
  <p>A maximum line length of 127 characters is allowed for the first line in an
interpreter scripts. </p>

  <p>The semantics of the optional-arg argument of an interpreter script vary
across implementations.  On Linux, the entire string following the interpreter
name is passed as a single argument to the interpreter, and this string can
include white space.  However, behavior differs on some other systems.  Some
systems use the first white space to terminate optional-arg. On  some
systems, an interpreter script can have multiple arguments, and white spaces
in optional-arg are used to delimit the arguments.</p>
</blockquote>

<p>So, the second line allows passing multiple arguments to <code>nix-shell</code>, allowing
for spaces in those arguments, and dealing with a potential line-length limit.</p>

<h2 id="examples">Examples</h2>

<p>The <code>-i</code> parameter to <code>nix-shell</code> tells it which interpreter to use when executing
the script.  Often, it is from one of the dependencies, such as in the above
example.  The <code>-p</code> parameter gives one or more dependencies to be used. After
the above lines follows the script (shamelessly borrowed from the
<a href="https://wiki.archlinux.org/index.php/Desktop_notifications#Usage_in_programming">ArchWiki</a>): </p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#! /usr/bin/env nix-shell</span>
<span class="c">#! nix-shell -i python3 -p python3 python34Packages.pygobject3 libnotify gobjectIntrospection gdk_pixbuf</span>

<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Notify</span>
<span class="n">Notify</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="n">Hello</span><span class="o">=</span><span class="n">Notify</span><span class="o">.</span><span class="n">Notification</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">,</span><span class="s">&quot;This is an example notification.&quot;</span><span class="p">,</span><span class="s">&quot;dialog-information&quot;</span><span class="p">)</span>
<span class="n">Hello</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

<p>But its usefulness isn’t limited to just writing scripts interpreted by one of the
declared dependencies.  I needed to write a wrapper for some NodeJS scripts I
had installed in the node_modules directory of a project I am working on.  I
didn’t want Node installed globally, so I did this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env nix-shell</span>
<span class="c">#! nix-shell -i bash -p nodejs</span>

<span class="nb">readonly </span><span class="nv">BIN_DIR</span><span class="o">=</span><span class="s2">&quot;$(cd -P &quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;${BASH_SOURCE[0]}&quot;</span><span class="k">)</span><span class="s2">&quot; &amp;&amp; pwd)&quot;</span>
<span class="nb">readonly </span><span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;$(basename ${BASH_SOURCE[0]/%-wrapper/})&quot;</span>

<span class="s2">&quot;${BIN_DIR}&quot;</span>/<span class="s2">&quot;${CMD}&quot;</span> <span class="s2">&quot;$@&quot;</span></code></pre></div>

<p>I simply made a symlink for each program in my <code>node_modules/.bin</code> directory to
this file, with the name <code>program-wrapper</code>, for example, <code>tern-wrapper</code> to wrap
<a href="http://ternjs.net/">tern</a>.  Notice my script doesn’t directly call nodejs,
though the underlying script it calls does.</p>

<p>I wrote the following script to render this document as I was
writing it to check the way it looked in HTML:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env nix-shell</span>
<span class="c">#! nix-shell -i bash -p inotifyTools pandoc</span>

<span class="nb">readonly </span><span class="nv">FILE</span><span class="o">=</span><span class="s2">&quot;$*&quot;</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-lt <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage:  ${0} MARKDOWN_FILE&quot;</span> 2&gt;<span class="p">&amp;</span>1
    <span class="nb">echo</span> <span class="s2">&quot;&quot;</span> 2&gt;<span class="p">&amp;</span>1
    <span class="nb">echo</span> <span class="s2">&quot;MARKDOWN_FILE must exist before launching.&quot;</span> 2&gt;<span class="p">&amp;</span>1
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> ! -e <span class="s2">&quot;${FILE}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;${FILE} doesn&#39;t yet exist, create it before launching!&quot;</span> 2&gt;<span class="p">&amp;</span>1
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Assume the extension is .md</span>
<span class="nb">readonly </span><span class="nv">OUTPUT</span><span class="o">=</span><span class="k">$(</span>basename <span class="s2">&quot;${FILE}&quot;</span> <span class="s2">&quot;.md&quot;</span><span class="k">)</span>.html

<span class="nb">echo</span> <span class="s2">&quot;Press Control-C to quit watching for changes on ${FILE}.&quot;</span>
<span class="k">while</span> <span class="nb">true</span><span class="p">;</span> <span class="k">do</span>
    inotifywait -q -e modify <span class="s2">&quot;${FILE}&quot;</span> <span class="o">&amp;&amp;</span>
        <span class="nb">echo</span> <span class="s2">&quot;Updating HTML for ${FILE}&quot;</span> <span class="o">&amp;&amp;</span>
        pandoc -s -f markdown -t html -o <span class="s2">&quot;${OUTPUT}&quot;</span> <span class="s2">&quot;${FILE}&quot;</span>
<span class="k">done</span></code></pre></div>

<p>One last example, where I couldn’t use <code>nix-shell</code> in a shebang line.  I was
playing with <a href="http://jaspervdj.be/hakyll/">Hakyll</a>.  After you use <code>haykll-init</code>
to generate your project structure, all work is done by compiling your own code
(in this case, a <code>site.hs</code> that has an accompanying cabal file.  Since something
similar to the example from the release notes didn’t work, I tried the
following, a variant of what I’ve used in <code>.nix</code> files.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env nix-shell</span>
<span class="c">#! nix-shell --pure -i bash -p &#39;pkgs.haskellPackages.ghcWithPackages (pkgs: with pkgs; [ hakyll cabal-install ])&#39;</span>

cabal run <span class="nv">$@</span></code></pre></div>

<p>But <code>nix-shell</code> didn’t like this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">nafai@shedemei:~/Documents/blog/hakyll/technically
<span class="nv">$ </span>./site-wrapper 
error: syntax error, unexpected <span class="s1">&#39;)&#39;</span>, at <span class="o">(</span>string<span class="o">)</span>:1:66</code></pre></div>

<p>So I had to just make this one a regular shell script:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#! /usr/bin/env bash</span>

nix-shell --pure <span class="se">\</span>
          -p <span class="s2">&quot;pkgs.haskellPackages.ghcWithPackages (pkgs: with pkgs; [ hakyll cabal-install ])&quot;</span> <span class="se">\</span>
          --run <span class="s2">&quot;cabal run $@&quot;</span></code></pre></div>

<p>Anyway, just in these last few days I’ve found interesting ways to use this new
capability.  I hope this gives some examples of how it may be used.  I plan on
writing more posts about other ways I have used this and other useful ways I
have used Nix tools.  I welcome any feedback from more experienced Nix users (or
comments in general about my scripting, I’m a little out of practice).</p>

<h2 id="updates">Updates</h2>
<p>On June 22, 2015, I updated the post to expand the explanation of why this might
be used, why <code>/usr/bin/env</code> was used along with a second script line, and
cleaned up and made my examples more consistent.</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    Previous
  
  <ul class="inline-list">
    <li>
      
        <span class="current-page">1</span>
      
    </li>
    
      <li>
        
          <a href="http://iam.travishartwell.net/page2">2</a>
        
      </li>
    
      <li>
        
          <a href="http://iam.travishartwell.net/page3">3</a>
        
      </li>
    
      <li>
        
          <a href="http://iam.travishartwell.net/page4">4</a>
        
      </li>
    
      <li>
        
          <a href="http://iam.travishartwell.net/page5">5</a>
        
      </li>
    
      <li>
        
          <a href="http://iam.travishartwell.net/page6">6</a>
        
      </li>
    
  </ul>
  
    <a href="http://iam.travishartwell.net/page2" class="btn">Next</a>
  
</div><!-- /.pagination -->

</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Travis B. Hartwell. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://iam.travishartwell.net/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://iam.travishartwell.net/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-25143601-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


          

</body>
</html>